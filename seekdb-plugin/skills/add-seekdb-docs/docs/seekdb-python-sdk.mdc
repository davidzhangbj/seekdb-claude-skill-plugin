---
description: Use these rules when working with seekDB Python SDK, including embedded mode and client/server connections
globs: *.py
alwaysApply: false
---

# seekDB Python SDK Guidelines

## Overview

seekDB provides a Python SDK (`pyseekdb`) that supports both embedded mode (for local development) and client/server mode (for production deployments). The SDK provides a unified API interface that supports connections to embedded-mode seekdb, server-mode seekdb, and OceanBase databases.

### Prerequisites

- Operating system: Linux (glibc >= 2.28)
- Python version: Python 3.11 and later
- System architecture: x86_64, aarch64

## Installation

```bash
# Install pyseekdb (this also installs embedded-mode seekdb)
pip install pyseekdb

# If your pip version is low, upgrade pip first
pip install --upgrade pip
```

## Connection Modes

### Embedded Mode

Embedded mode runs seekDB directly in your Python process, ideal for development, testing, and lightweight deployments. Installing `pyseekdb` automatically installs embedded-mode seekdb.

```python
import pyseekdb

# Initialize embedded seekDB (local SeekDB)
client = pyseekdb.Client()
```

### Client/Server Mode

Connect to a remote seekDB server.

```python
import pyseekdb

# Connect to remote SeekDB server
client = pyseekdb.Client(
    host="127.0.0.1",
    port=2881,
    database="test",
    user="root",
    password=""
)
```

### OceanBase Mode

Connect to an OceanBase database server.

```python
import pyseekdb

# Connect to OceanBase Server
client = pyseekdb.Client(
    host="127.0.0.1",
    port=2881,
    tenant="test",  # OceanBase default tenant
    database="test",
    user="root",
    password=""
)
```

## Basic Operations

### Create a Collection

A collection is like a table that stores documents with vector embeddings. Collections can use embedding functions to automatically convert documents to embeddings.

```python
import pyseekdb

# Create client connection (embedded mode)
client = pyseekdb.Client()

# Create collection with default embedding function
# The embedding function will automatically convert documents to embeddings
collection_name = "my_simple_collection"
collection = client.create_collection(
    name=collection_name,
)

print(f"Created collection '{collection_name}' with dimension: {collection.dimension}")
print(f"Embedding function: {collection.embedding_function}")
```

### Add Data to Collection

With embedding functions, you can add documents directly without providing embeddings. The embedding function will automatically generate embeddings from documents.

```python
documents = [
    "Machine learning is a subset of artificial intelligence",
    "Python is a popular programming language",
    "Vector databases enable semantic search",
    "Neural networks are inspired by the human brain",
    "Natural language processing helps computers understand text"
]

ids = ["id1", "id2", "id3", "id4", "id5"]

# Add data with documents only - embeddings will be auto-generated by embedding function
collection.add(
    ids=ids,
    documents=documents,  # embeddings will be automatically generated
    metadatas=[
        {"category": "AI", "index": 0},
        {"category": "Programming", "index": 1},
        {"category": "Database", "index": 2},
        {"category": "AI", "index": 3},
        {"category": "NLP", "index": 4}
    ]
)

print(f"Added {len(documents)} documents to collection")
print("Note: Embeddings were automatically generated from documents using the embedding function")
```

### Query the Collection

With embedding functions, you can query using text directly. The embedding function will automatically convert query text to query vector.

```python
# Query using text - query vector will be auto-generated by embedding function
query_text = "artificial intelligence and machine learning"

results = collection.query(
    query_texts=query_text,  # Query text - will be embedded automatically
    n_results=3  # Return top 3 most similar documents
)

print(f"Query: '{query_text}'")
print(f"Query results: {len(results['ids'][0])} items found")

# Print query results
for i in range(len(results['ids'][0])):
    print(f"\nResult {i+1}:")
    print(f"  ID: {results['ids'][0][i]}")
    print(f"  Distance: {results['distances'][0][i]:.4f}")
    if results.get('documents'):
        print(f"  Document: {results['documents'][0][i]}")
    if results.get('metadatas'):
        print(f"  Metadata: {results['metadatas'][0][i]}")
```

### Delete Collection

```python
# Delete the collection
client.delete_collection(collection_name)
print(f"Deleted collection '{collection_name}'")
```

## Vector Operations

### Using Embedding Functions (Recommended)

The recommended approach is to use embedding functions that automatically generate embeddings from documents. This simplifies the workflow and ensures consistent embedding generation.

```python
import pyseekdb

# Create client and collection
client = pyseekdb.Client()
collection = client.create_collection(name="my_collection")

# Add documents - embeddings are automatically generated
collection.add(
    ids=["1", "2", "3"],
    documents=[
        "Machine learning is a subset of artificial intelligence",
        "Python is a popular programming language",
        "Vector databases enable semantic search"
    ]
)

# Query using text - query vector is automatically generated
results = collection.query(
    query_texts="artificial intelligence",
    n_results=2
)
```

### Manual Vector Operations

If you need to work with pre-computed embeddings, you can provide vectors directly:

```python
import numpy as np

# Generate or load embedding vectors
embeddings = [
    np.random.rand(1536).astype(np.float32).tolist(),
    np.random.rand(1536).astype(np.float32).tolist(),
]

# Add with pre-computed embeddings
collection.add(
    ids=["1", "2"],
    embeddings=embeddings,
    documents=["Document 1", "Document 2"]
)

# Query with pre-computed query vector
query_embedding = np.random.rand(1536).astype(np.float32).tolist()
results = collection.query(
    query_embeddings=[query_embedding],
    n_results=5
)
```

## Complete Example

Here's a complete example demonstrating the basic usage with embedding functions:

```python
"""
Simple Example: Basic usage of SeekDBClient with Embedding Functions

This example demonstrates the most common operations with embedding functions:
1. Create a client connection
2. Create a collection with embedding function
3. Add data using documents (embeddings auto-generated)
4. Query using query texts (embeddings auto-generated)
5. Print query results
"""
import pyseekdb

# ==================== Step 1: Create Client Connection ====================
# Embedded mode (local SeekDB)
client = pyseekdb.Client()

# Alternative: Server mode (connecting to remote SeekDB server)
# client = pyseekdb.Client(
#     host="127.0.0.1",
#     port=2881,
#     database="test",
#     user="root",
#     password=""
# )

# ==================== Step 2: Create a Collection with Embedding Function ====================
collection_name = "my_simple_collection"

# Create collection with default embedding function
collection = client.create_collection(
    name=collection_name,
)

print(f"Created collection '{collection_name}' with dimension: {collection.dimension}")
print(f"Embedding function: {collection.embedding_function}")

# ==================== Step 3: Add Data to Collection ====================
documents = [
    "Machine learning is a subset of artificial intelligence",
    "Python is a popular programming language",
    "Vector databases enable semantic search",
    "Neural networks are inspired by the human brain",
    "Natural language processing helps computers understand text"
]

ids = ["id1", "id2", "id3", "id4", "id5"]

collection.add(
    ids=ids,
    documents=documents,  # embeddings will be automatically generated
    metadatas=[
        {"category": "AI", "index": 0},
        {"category": "Programming", "index": 1},
        {"category": "Database", "index": 2},
        {"category": "AI", "index": 3},
        {"category": "NLP", "index": 4}
    ]
)

print(f"\nAdded {len(documents)} documents to collection")

# ==================== Step 4: Query the Collection ====================
query_text = "artificial intelligence and machine learning"

results = collection.query(
    query_texts=query_text,  # Query text - will be embedded automatically
    n_results=3  # Return top 3 most similar documents
)

print(f"\nQuery: '{query_text}'")
print(f"Query results: {len(results['ids'][0])} items found")

# ==================== Step 5: Print Query Results ====================
for i in range(len(results['ids'][0])):
    print(f"\nResult {i+1}:")
    print(f"  ID: {results['ids'][0][i]}")
    print(f"  Distance: {results['distances'][0][i]:.4f}")
    if results.get('documents'):
        print(f"  Document: {results['documents'][0][i]}")
    if results.get('metadatas'):
        print(f"  Metadata: {results['metadatas'][0][i]}")

# ==================== Step 6: Cleanup ====================
client.delete_collection(collection_name)
print(f"\nDeleted collection '{collection_name}'")
```

## Additional Features

seekDB also supports:
- **Full-text indexing**: For text-based search capabilities
- **Hybrid search**: Combining vector search with full-text search
- **AI function service**: For AI-powered operations
- **Hybrid vector index**: Advanced indexing options

For more detailed information on these features, see the official documentation.

## Best Practices

### 1. Use Embedding Functions

```python
# ✅ Good: Use embedding functions for automatic embedding generation
collection = client.create_collection(name="my_collection")
collection.add(ids=["1"], documents=["Sample text"])

# ❌ Avoid: Manual embedding generation unless necessary
# Only use manual embeddings if you have pre-computed vectors
```

### 2. Collection Management

```python
# ✅ Good: Reuse collections for better performance
collection = client.create_collection(name="my_collection")
# ... add data and query multiple times ...

# Clean up when done
client.delete_collection("my_collection")
```

### 3. Batch Operations

```python
# ✅ Good: Add multiple documents at once
collection.add(
    ids=["1", "2", "3"],
    documents=["Doc 1", "Doc 2", "Doc 3"],
    metadatas=[{"cat": "A"}, {"cat": "B"}, {"cat": "C"}]
)

# ❌ Avoid: Adding documents one at a time in a loop
# for i, doc in enumerate(documents):
#     collection.add(ids=[str(i)], documents=[doc])
```

### 4. Query Optimization

```python
# ✅ Good: Specify appropriate n_results
results = collection.query(
    query_texts="search query",
    n_results=10  # Only retrieve what you need
)

# ✅ Good: Use metadata filters when available
# (if supported by your seekDB version)
```

### 5. Error Handling

```python
try:
    collection = client.create_collection(name="my_collection")
    collection.add(ids=["1"], documents=["Sample text"])
except Exception as e:
    print(f"Error: {e}")
    # Handle error appropriately
```

## Resources

- Official Documentation: https://www.oceanbase.ai/docs/
- Python SDK Documentation: https://www.oceanbase.ai/docs/using-seekdb-in-python-sdk
- For more detailed introduction and usage of pyseekdb, see the official pyseekdb documentation
- For more pyseekdb usage examples, see:
  - Complete example: Demonstrates all capabilities currently supported by pyseekdb
  - Hybrid search example: Demonstrates the usage of seekdb hybrid search
- In addition to the Python SDK, seekdb also supports operations through SQL. For SQL usage, see the client/server mode documentation
